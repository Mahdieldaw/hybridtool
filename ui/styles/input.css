@import 'tailwindcss/base';
@import 'tailwindcss/components';
@import 'tailwindcss/utilities';

/* Import Math Styles (Lazy-loaded logic handled by component, but styles here for now) */
@import './math-styles.css';

/* CSS Custom Properties */
:root {
    --font-dm-mono: 'DM Mono';
}

/* ============================================================================
   Council Orbs Enhanced Styles (GPU-accelerated)
   ============================================================================ */

/* Variables */
:root {
    --council-orb-size: 24px;
    --council-orb-size-voice: 32px;
    --council-orb-gap: 24px;
    --council-transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
    --council-transition-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Containers */
.council-container {
    position: relative;
    width: 100%;
}

.council-orb-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 16px 0;
    background: transparent;
}

.council-orb-bar::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 300px;
    height: 100px;
    background: radial-gradient(ellipse at center, rgba(255, 255, 255, 0.03) 0%, transparent 70%);
    pointer-events: none;
}

.council-orb-bar--active {
    /* No backdrop - orbs are now inside the chat input container */
    background: transparent;
    backdrop-filter: none;
    border: none;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
}

.council-orb-bar--active::before {
    display: none;
}

/* Groups */
.council-orb-group {
    display: flex;
    align-items: center;
    gap: var(--council-orb-gap);
    flex: 1;
}

.council-orb-group--left {
    justify-content: flex-end;
    padding-right: 16px;
}

.council-orb-group--right {
    justify-content: flex-start;
    padding-left: 16px;
}

/* Voice Zone */
.council-voice-zone {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 56px;
    height: 56px;
    flex-shrink: 0;
}

.council-glass-ring {
    position: absolute;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 1px solid rgba(255, 255, 255, 0.06);
    background: radial-gradient(circle at center, rgba(255, 255, 255, 0.02) 0%, transparent 70%);
}

/* Orb Wrapper */
.council-orb-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s var(--council-transition-smooth);
}

.council-orb-wrapper--voice {
    z-index: 5;
}

.council-orb-wrapper--inactive {
    opacity: 0.5;
    filter: saturate(0.3);
}

.council-orb-wrapper:hover {
    transform: scale(1.1) translateY(-2px);
    z-index: 10;
}

/* Crown */
.council-crown {
    position: absolute;
    top: -16px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 14px;
    z-index: 20;
    background: none;
    border: none;
    cursor: pointer;
    transition: all 0.3s var(--council-transition-bounce);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

.council-crown--active {
    animation: crown-float 2s ease-in-out infinite;
    filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6)) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

.council-crown--historical {
    opacity: 0.4;
    filter: grayscale(1);
    cursor: default;
}

.council-crown--selecting {
    animation: crown-pulse 0.5s ease-in-out infinite;
    filter: drop-shadow(0 0 12px rgba(139, 92, 246, 0.8)) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

@keyframes crown-float {

    0%,
    100% {
        transform: translateX(-50%) translateY(0);
    }

    50% {
        transform: translateX(-50%) translateY(-3px);
    }
}

@keyframes crown-pulse {

    0%,
    100% {
        transform: translateX(-50%) scale(1);
    }

    50% {
        transform: translateX(-50%) scale(1.2);
    }
}

/* Progress Ring */
.council-progress-ring {
    position: absolute;
    width: calc(var(--council-orb-size) + 12px);
    height: calc(var(--council-orb-size) + 12px);
    pointer-events: none;
    z-index: 1;
}

.council-orb-wrapper--voice .council-progress-ring {
    width: calc(var(--council-orb-size-voice) + 14px);
    height: calc(var(--council-orb-size-voice) + 14px);
}

.council-progress-ring__progress {
    transition: stroke-dashoffset 0.3s var(--council-transition-smooth);
    will-change: stroke-dashoffset;
}

/* Orb Button */
.council-orb {
    position: relative;
    width: var(--council-orb-size);
    height: var(--council-orb-size);
    border-radius: 50%;
    border: none;
    cursor: pointer;
    overflow: hidden;
    will-change: transform, box-shadow;
    transform: translateZ(0);
    backface-visibility: hidden;
    transition: transform 0.3s var(--council-transition-bounce), box-shadow 0.3s var(--council-transition-smooth), filter 0.3s var(--council-transition-smooth);
    box-shadow: 0 0 20px -4px var(--orb-color), 0 4px 12px rgba(0, 0, 0, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.1);
}

.council-orb--voice {
    width: var(--council-orb-size-voice);
    height: var(--council-orb-size-voice);
    box-shadow: 0 0 30px -4px var(--orb-color), 0 0 60px -8px var(--orb-color), 0 6px 16px rgba(0, 0, 0, 0.4), inset 0 2px 4px rgba(255, 255, 255, 0.15);
}

.council-orb--regular:hover {
    transform: scale(1.25) translateY(-4px);
    box-shadow: 0 0 30px -2px var(--orb-color), 0 0 50px -8px var(--orb-color), 0 8px 24px rgba(0, 0, 0, 0.4);
}

/* Orb Internals */
.council-orb__core {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25) 0%, transparent 50%), radial-gradient(circle at 70% 70%, rgba(0, 0, 0, 0.3) 0%, transparent 50%), linear-gradient(135deg, var(--orb-color) 0%, var(--orb-accent) 100%);
    z-index: 1;
}

.council-orb__glow {
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    background: radial-gradient(circle at center, var(--orb-color) 0%, transparent 70%);
    opacity: 0.3;
    z-index: 0;
    animation: glow-breathe 3s ease-in-out infinite;
}

@keyframes glow-breathe {

    0%,
    100% {
        opacity: 0.2;
        transform: scale(1);
    }

    50% {
        opacity: 0.4;
        transform: scale(1.1);
    }
}

.council-orb__spinner {
    position: absolute;
    inset: 2px;
    border-radius: 50%;
    background: conic-gradient(from 0deg, transparent 0deg, var(--orb-color) 30deg, transparent 60deg);
    opacity: 0.6;
    z-index: 2;
    animation: spin-smooth 6s linear infinite;
    will-change: transform;
    transform: translateZ(0);
}

@keyframes spin-smooth {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

.council-orb__logo {
    position: absolute;
    inset: 15%;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    opacity: 0.5;
    z-index: 3;
    transition: opacity 0.3s ease;
    filter: brightness(1.2);
}

.council-orb:hover .council-orb__logo {
    opacity: 1;
}

.council-orb__pulse {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: radial-gradient(circle at center, var(--orb-color) 0%, transparent 70%);
    z-index: 4;
    animation: pulse-stream 1s ease-out infinite;
}

@keyframes pulse-stream {
    0% {
        opacity: 0.5;
        transform: scale(0.8);
    }

    100% {
        opacity: 0;
        transform: scale(1.5);
    }
}

/* Orb State Mods */
.council-orb--historical {
    filter: grayscale(0.8) brightness(0.7);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.council-orb--historical .council-orb__spinner {
    animation-duration: 20s;
    opacity: 0.2;
}

.council-orb--historical .council-orb__glow {
    animation: none;
    opacity: 0.1;
}

.council-orb--historical:hover {
    filter: none;
    box-shadow: 0 0 25px -4px var(--orb-color), 0 6px 16px rgba(0, 0, 0, 0.3);
}

.council-orb--historical:hover .council-orb__spinner {
    animation-duration: 4s;
    opacity: 0.6;
}

.council-orb--error {
    --orb-color: #EF4444;
    --orb-accent: #B91C1C;
    animation: error-shake 0.5s ease-in-out;
}

@keyframes error-shake {

    0%,
    100% {
        transform: translateX(0);
    }

    20%,
    60% {
        transform: translateX(-3px);
    }

    40%,
    80% {
        transform: translateX(3px);
    }
}

.council-orb--streaming .council-orb__spinner {
    animation-duration: 2s;
}

.council-orb--crown-target {
    animation: target-pulse 1s ease-in-out infinite;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.5), 0 0 20px -4px var(--orb-color);
}

@keyframes target-pulse {

    0%,
    100% {
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3), 0 0 20px -4px var(--orb-color);
    }

    50% {
        box-shadow: 0 0 0 6px rgba(139, 92, 246, 0.5), 0 0 30px -4px var(--orb-color);
    }
}

.council-orb--disabled {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

.council-orb--selected {
    box-shadow: 0 0 25px -2px var(--orb-color), 0 0 50px -8px var(--orb-color), 0 0 0 2px rgba(255, 255, 255, 0.2);
}

.council-orb--unselected {
    filter: grayscale(0.6) brightness(0.6);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.council-orb--unselected:hover {
    filter: none;
}

/* Stage Badge */
.council-stage-badge {
    position: absolute;
    bottom: -8px;
    right: -8px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    z-index: 15;
    border: 2px solid rgba(0, 0, 0, 0.8);
    animation: badge-pop 0.3s var(--council-transition-bounce);
}

@keyframes badge-pop {
    from {
        transform: scale(0);
    }

    to {
        transform: scale(1);
    }
}

/* Tooltip */
.council-tooltip {
    position: absolute;
    bottom: calc(100% + 12px);
    left: 50%;
    transform: translateX(-50%);
    background: rgba(20, 20, 30, 0.95);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 8px 12px;
    white-space: nowrap;
    z-index: 100;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    animation: tooltip-fade-in 0.2s ease-out;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

@keyframes tooltip-fade-in {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(4px);
    }

    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

.council-tooltip__name {
    font-size: 13px;
    font-weight: 500;
    color: #fff;
}

.council-tooltip__stage {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.6);
}

.council-tooltip__action {
    font-size: 11px;
    color: #A78BFA;
}

/* Crown Mode Indicator */
.council-crown-indicator {
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%);
    color: white;
    font-size: 12px;
    font-weight: 500;
    padding: 6px 12px;
    border-radius: 20px;
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    animation: indicator-bounce 1s ease-in-out infinite;
    z-index: 50;
}

@keyframes indicator-bounce {

    0%,
    100% {
        transform: translateX(-50%) translateY(0);
    }

    50% {
        transform: translateX(-50%) translateY(-4px);
    }
}

/* Settings Button */
.council-settings-btn {
    position: absolute;
    right: -48px;
    top: 50%;
    transform: translateY(-50%);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(40, 40, 50, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.6);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.council-settings-btn:hover {
    background: rgba(60, 60, 70, 0.9);
    color: white;
    border-color: rgba(255, 255, 255, 0.2);
    transform: translateY(-50%) scale(1.05);
}

/* Menu Panel */
.council-menu {
    position: absolute;
    left: 50%;
    bottom: calc(100% + 16px);
    transform: translateX(-50%);
    background: rgba(25, 25, 35, 0.98);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 20px;
    min-width: 560px;
    max-width: 640px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);
    z-index: 100;
    animation: menu-slide-up 0.3s var(--council-transition-bounce);
}

@keyframes menu-slide-up {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

.council-menu__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.council-menu__header h3 {
    font-size: 14px;
    font-weight: 600;
    color: white;
    margin: 0;
}

.council-menu__close {
    width: 24px;
    height: 24px;
    border-radius: 6px;
    border: none;
    background: rgba(255, 255, 255, 0.05);
    color: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.council-menu__close:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.council-menu__grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.council-menu__section {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.council-menu__section--full {
    grid-column: span 2;
}

.council-menu__label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.7);
}

.council-menu__options {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.council-menu__options--wrap {
    flex-direction: row;
    flex-wrap: wrap;
}

.council-menu__chip {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    background: rgba(255, 255, 255, 0.03);
    color: rgba(255, 255, 255, 0.7);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.council-menu__chip:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--chip-color);
}

.council-menu__chip--selected {
    background: rgba(139, 92, 246, 0.15);
    border-color: rgba(139, 92, 246, 0.5);
    color: white;
}

.council-menu__chip--small {
    padding: 6px 10px;
}

.council-menu__chip:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.council-menu__chip-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}

.council-menu__chip-check {
    margin-left: auto;
    color: #A78BFA;
}

.council-menu__chip-lock {
    margin-left: auto;
    font-size: 10px;
}

@layer base {

    /* Font Face Declarations */
    @font-face {
        font-family: 'Inter';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url('../fonts/Inter-Regular.woff2') format('woff2');
    }

    @font-face {
        font-family: 'Inter';
        font-style: normal;
        font-weight: 600;
        font-display: swap;
        src: url('../fonts/Inter-SemiBold.woff2') format('woff2');
    }

    @font-face {
        font-family: 'DM Mono';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url('../fonts/DMMono-Regular.ttf') format('truetype');
    }

    /* CSS Custom Properties */
    :root {
        --font-dm-mono: 'DM Mono';
    }

    /* Base Styles */
    body {
        @apply font-sans text-text-primary bg-surface text-base leading-relaxed;
    }

    #root {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    header {
        background-color: #2c3e50;
        color: #ecf0f1;
        padding: 15px 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    header h1 {
        margin: 0;
        font-size: 24px;
    }

    nav ul {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
    }

    nav li {
        margin-left: 20px;
    }

    nav a {
        color: #ecf0f1;
        text-decoration: none;
        font-weight: bold;
        transition: color 0.3s ease;
    }

    nav a:hover {
        color: #3498db;
    }

    main {
        flex-grow: 1;
        padding: 20px;
    }

    footer {
        background-color: #2c3e50;
        color: #ecf0f1;
        text-align: center;
        padding: 10px 20px;
        box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
        font-size: 14px;
    }

    /* Layout clamps */
    html,
    body,
    #root {
        max-width: 100%;
        overflow-x: hidden;
    }

    .singularity-app-container,
    .main-content-wrapper,
    .chat-area {
        width: 100%;
        max-width: 100%;
        min-width: 0;
        overflow-x: hidden;
    }

    /* Ensure long words/content wrap within the editor */
    .ProseMirror {
        overflow-wrap: anywhere;
        word-break: break-word;
    }
}

@layer components {
    .batch-filler {
        overflow: hidden;
    }

    .primaries {
        overflow: visible;
    }

    .user-turn-block pre,
    .ai-turn-block pre {
        max-width: 100%;
        overflow-x: auto;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
    }

    .card {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
    }

    .button {
        display: inline-block;
        background-color: #3498db;
        color: #fff;
        padding: 10px 15px;
        border-radius: 5px;
        text-decoration: none;
        transition: background-color 0.3s ease;
    }

    .button:hover {
        background-color: #2980b9;
    }

    .streaming-dots::after {
        content: "● ● ●";
        font-size: 12px;
        letter-spacing: 0.1em;
        color: #c084fc;
        animation: pulse 1.2s infinite;
    }

    .copy-button-wrapper {
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
    }

    .provider-block:hover .copy-button-wrapper {
        opacity: 1;
    }

    .truncated-content {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        line-clamp: 3;
    }

    .composer-toolbar {
        width: 100%;
    }

    .chat-view,
    .chat-input-wrapper,
    .chat-main,
    main {
        min-height: 0 !important;
    }

    .chat-input-wrapper {
        flex: 0 0 auto !important;
        z-index: 10;
    }

    .htos-citation-pill {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 0 6px;
        margin-left: 4px;
        margin-right: 4px;
        background-color: #2563eb;
        border: 1px solid #1d4ed8;
        border-radius: 9999px;
        color: #ffffff;
        font-size: 12px;
        font-weight: 700;
        line-height: 1.4;
        cursor: pointer;
        user-select: none;
        box-shadow: 0 0 0 1px rgba(29, 78, 216, 0.6);
        transition: transform 0.1s ease, background-color 0.1s ease;
    }

    .htos-citation-pill:hover {
        background-color: #1d4ed8;
        transform: translateY(-1px);
    }

    .htos-citation-pill:active {
        transform: translateY(0);
    }

    /* Reset block code inside pre to prevent bubble styling */
    .markdown-body pre code {
        background: transparent;
        border: none;
        padding: 0;
        display: inline;
        white-space: pre;
    }

    /* Council Orbs Styles (Migrated from module) */

    /* Orb Bar Container */
    .council-orb-bar {
        /* Fully transparent with subtle borders */
        background: transparent;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        padding: 12px 0;
    }

    .council-orb-bar::before {
        content: '';
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 200px;
        height: 200px;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.08) 0%, transparent 70%);
        pointer-events: none;
        z-index: 0;
    }

    /* Override: Active variant should have no borders */
    .council-orb-bar--active {
        border-top: none !important;
        border-bottom: none !important;
        padding: 0 !important;
        background: transparent !important;
    }

    .council-orb-bar--active::before {
        display: none !important;
    }

    /* Glass ring around voice orb */
    .council-glass-ring {
        position: absolute;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.08);
        pointer-events: none;
        z-index: 0;
    }

    /* Base Orb Styles */
    .council-orb {
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #ffffff44, #00000066);
        box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
        transition: all 0.3s cubic-bezier(0.17, 0.67, 0.12, 1.34);
        position: relative;
        overflow: hidden;
        z-index: 1;
    }

    /* Size variants */
    .council-orb-regular {
        width: 28px;
        height: 28px;
    }

    .council-orb-voice {
        width: 32px;
        height: 32px;
    }

    .council-orb::before {
        content: '';
        position: absolute;
        inset: 0;
        background: conic-gradient(from var(--rotation, 0deg),
                var(--model-color),
                transparent 80%);
        opacity: 0.8;
        animation: spin 8s linear infinite, breathe 4s infinite alternate;
        z-index: 0;
    }

    /* Logo backdrop - ALWAYS visible at 35%, scales to 100% on hover */
    .council-orb::after {
        content: '';
        position: absolute;
        inset: 0;
        background-image: var(--logo-src);
        background-size: 60%;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 0.35;
        transition: opacity 0.4s ease-in-out;
        z-index: 2;
    }

    .council-orb:hover::after {
        opacity: 1;
    }

    .council-orb:hover {
        transform: scale(1.4) translateY(-4px);
        box-shadow: 0 0 24px var(--model-color);
        z-index: 10;
    }

    .council-orb-voice {
        box-shadow: 0 0 20px var(--model-color), 0 0 0 3px #ffffff44;
        animation: goldenPulse 2s infinite;
    }

    .council-orb-streaming::after {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(circle, var(--model-color) 0%, transparent 70%);
        opacity: 0.3;
        animation: fillPulse 1.5s infinite;
        z-index: 2;
    }

    .council-orb-error {
        background: radial-gradient(circle at 30% 30%, #ff000022, #00000044);
        box-shadow: 0 0 12px rgba(255, 0, 0, 0.5);
    }

    .council-orb-error::before {
        background: conic-gradient(from var(--rotation, 0deg),
                #ef4444,
                transparent 80%);
    }

    .council-orb__error-mark {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: 800;
        color: #ef4444;
        z-index: 4;
        pointer-events: none;
        text-shadow: 0 0 8px rgba(239, 68, 68, 0.65);
        opacity: 0.95;
    }

    /* Variant-specific styles */
    .council-tray {
        width: auto;
    }

    .council-divider {
        max-width: 80%;
    }

    .council-historical {
        max-width: 80%;
    }

    .council-historical-dimmed {
        opacity: 0.5;
    }

    .council-tray-dimmed-split {
        opacity: 0.4;
        filter: grayscale(50%);
    }

    /* Historical orbs: Slightly muted but still colored (75% saturation) */
    .council-orb-historical {
        animation: none !important;
        filter: saturate(0.75) brightness(0.85);
        /* Slightly muted, not grayscale */
        transform: scale(0.85);
        /* Physically recede */
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.3) !important;
        /* Subtle shadow */
    }

    /* Remove internal animations for dormant state */
    .council-orb-historical::before {
        animation: none !important;
        opacity: 0.3;
    }

    /* Reset separate voice styling for historical to match unison "dormant" look */
    .council-orb-historical.council-orb-voice {
        animation: none !important;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.3) !important;
        width: 28px;
        /* Normalize size to match others until hover */
        height: 28px;
    }

    /* WAKE UP on hover: Restore full saturation, scale, and glow */
    .council-orb-historical:hover {
        filter: saturate(1) brightness(1);
        transform: scale(1.15) translateY(-2px);
        box-shadow: 0 0 20px var(--model-color) !important;
        z-index: 50;
        cursor: pointer;
    }

    /* Restore internal vitality on hover */
    .council-orb-historical:hover::before {
        opacity: 0.8;
        animation: spin 4s linear infinite !important;
    }

    .council-orb-historical:hover::after {
        opacity: 1;
    }

    /* Ensure smooth transition for dimming */
    .council-tray-container {
        transition: opacity 0.5s ease-in-out;
    }

    /* Override historical muting for orbs that are STREAMING or ACTIVE */
    /* These orbs should look bright to draw attention */
    .council-orb-historical.council-orb-streaming,
    .council-orb-historical.council-orb--start-pulse,
    .council-orb-historical.council-orb--complete-flash {
        filter: saturate(1) brightness(1);
        transform: scale(1);
        box-shadow: 0 0 20px var(--model-color) !important;
    }

    .council-orb-historical.council-orb-streaming::before {
        opacity: 0.8;
        animation: spin 3s linear infinite !important;
    }

    /* Per-orb animations for streaming start/finish */
    @keyframes orb-start-pulse {
        0% {
            transform: scale(1);
            box-shadow: 0 0 0 0 var(--model-color);
        }

        50% {
            transform: scale(1.2);
            box-shadow: 0 0 25px 6px var(--model-color);
        }

        100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 transparent;
        }
    }

    @keyframes orb-complete-flash {
        0% {
            filter: brightness(1);
        }

        50% {
            filter: brightness(1.4);
        }

        100% {
            filter: brightness(1);
        }
    }

    .council-orb--start-pulse {
        animation: orb-start-pulse 0.6s ease-out !important;
    }

    .council-orb--complete-flash {
        animation: orb-complete-flash 0.5s ease-out !important;
    }

    /* Decision Map Sheet Premium Styling */
    .decision-sheet-bg {
        background: #000000;
        position: relative;
    }

    /* Noise texture overlay */
    .decision-sheet-bg::before {
        content: '';
        position: absolute;
        inset: 0;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        opacity: 0.03;
        pointer-events: none;
        z-index: 0;
    }

    /* Pill-shaped tabs */
    .decision-tab-pill {
        padding: 0.5rem 1.25rem;
        border-radius: 9999px;
        font-size: 0.8125rem;
        font-weight: 600;
        letter-spacing: 0.025em;
        transition: all 0.3s ease;
        border: 1px solid transparent;
        background: rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.6);
    }

    .decision-tab-pill:hover {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.85);
    }

    /* Graph tab active - violet */
    .decision-tab-active-graph {
        background: rgba(139, 92, 246, 0.2);
        border-color: rgba(139, 92, 246, 0.5);
        color: #a78bfa;
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.25), inset 0 0 12px rgba(139, 92, 246, 0.1);
    }

    /* Narrative tab active - amber */
    .decision-tab-active-narrative {
        background: rgba(245, 158, 11, 0.2);
        border-color: rgba(245, 158, 11, 0.5);
        color: #fbbf24;
        box-shadow: 0 0 20px rgba(245, 158, 11, 0.25), inset 0 0 12px rgba(245, 158, 11, 0.1);
    }

    /* Options tab active - emerald */
    .decision-tab-active-options {
        background: rgba(16, 185, 129, 0.2);
        border-color: rgba(16, 185, 129, 0.5);
        color: #34d399;
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.25), inset 0 0 12px rgba(16, 185, 129, 0.1);
    }

    /* Model orb badges (40px) for supporters */
    .decision-orb-badge {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), rgba(0, 0, 0, 0.4));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 700;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
    }

    .decision-orb-badge::before {
        content: '';
        position: absolute;
        inset: 0;
        background: conic-gradient(from 0deg, var(--orb-color), transparent 80%);
        opacity: 0.7;
        animation: spin 6s linear infinite;
    }

    .decision-orb-badge:hover {
        transform: scale(1.15);
        box-shadow: 0 0 16px var(--orb-color);
    }

    .decision-orb-badge span {
        position: relative;
        z-index: 1;
    }

    /* Detail view header */
    .decision-detail-header {
        font-size: 1.5rem;
        font-weight: 700;
        line-height: 1.3;
        max-width: 80%;
        text-align: center;
    }

    /* Narrative manuscript prose styling */
    .narrative-prose {
        max-width: 48rem;
        margin: 0 auto;
        line-height: 1.75;
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.9);
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
    }

    .narrative-prose p {
        margin-bottom: 1.25rem;
    }

    /* Superscript citations in narrative */
    .narrative-prose .citation-link {
        font-size: 0.7em;
        vertical-align: super;
        color: #8b5cf6;
        cursor: pointer;
        padding: 0 2px;
        transition: color 0.2s ease;
    }

    .narrative-prose .citation-link:hover {
        color: #a78bfa;
        text-decoration: underline;
    }

    /* Highlighted sentence in detail view */
    .narrative-highlight {
        background: rgba(139, 92, 246, 0.2);
        border-left: 3px solid #8b5cf6;
        padding: 0.5rem 1rem;
        margin: 0.5rem 0;
        border-radius: 0 8px 8px 0;
    }

    /* Theme section in Options tab */
    .options-theme-section {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        margin-bottom: 1rem;
        overflow: hidden;
    }

    .options-theme-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.25rem;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .options-theme-header:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    .options-theme-title {
        font-weight: 600;
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.9);
    }

    .options-theme-chevron {
        transition: transform 0.2s ease;
        color: rgba(255, 255, 255, 0.5);
    }

    .options-theme-chevron.expanded {
        transform: rotate(180deg);
    }

    .options-theme-content {
        padding: 0 1.25rem 1rem;
    }

    /* Option card */
    .option-card {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        transition: all 0.2s ease;
    }

    .option-card:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.15);
    }

    .option-card-title {
        font-weight: 600;
        font-size: 0.9375rem;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 0.5rem;
    }

    .option-card-description {
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.5;
        margin-bottom: 0.75rem;
    }

    .option-card-supporters {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    /* Back button in detail view */
    .decision-back-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(139, 92, 246, 0.15);
        border: 1px solid rgba(139, 92, 246, 0.4);
        border-radius: 8px;
        color: #a78bfa;
        font-size: 0.8125rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .decision-back-btn:hover {
        background: rgba(139, 92, 246, 0.25);
        box-shadow: 0 0 12px rgba(139, 92, 246, 0.3);
    }
}

@layer utilities {
    @keyframes breathe {
        from {
            opacity: 0.4;
        }

        to {
            opacity: 0.8;
        }
    }

    @keyframes fillPulse {

        0%,
        100% {
            opacity: 0.2;
        }

        50% {
            opacity: 0.5;
        }
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }

    @keyframes goldenPulse {

        0%,
        100% {
            box-shadow: 0 0 20px var(--model-color), 0 0 0 3px #ffffff44;
        }

        50% {
            box-shadow: 0 0 32px var(--model-color), 0 0 0 3px #ffffff66;
        }
    }



    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    /* Conflict edge slow pulse for red dashed lines */
    @keyframes conflictPulse {

        0%,
        100% {
            stroke-opacity: 0.4;
        }

        50% {
            stroke-opacity: 0.8;
        }
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Lightweight Math Styling */
    .math-inline {
        font-style: italic;
        font-family: 'Times New Roman', 'Georgia', serif;
        white-space: nowrap;
    }

    .math-text {
        font-style: normal;
        font-family: inherit;
    }

    .math-sup {
        font-size: 0.75em;
        vertical-align: super;
        line-height: 0;
    }

    .math-sub {
        font-size: 0.75em;
        vertical-align: sub;
        line-height: 0;
    }

    /* 
     FIX: Global Safety Net for Math Scrollbars
     Ensure the parent chat bubble allows the child to handle scrolling.
     We target the markdown body and the turn block to ensure no overflow: hidden clips the scrollbar.
  */
    .markdown-body,
    .ai-turn-block,
    .user-turn-block {
        overflow-wrap: break-word;
        /* overflow: hidden;  <-- DO NOT USE THIS, it clips the scrollbar */
    }
}

/* Scroll-Synced Response Panel Styles */
.message-row.active-turn {
    background-color: rgba(99, 102, 241, 0.05);
    border-right: 2px solid rgba(99, 102, 241, 0.4);
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

.custom-scrollbar::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
    background: rgba(148, 163, 184, 0.2);
    border-radius: 3px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgba(148, 163, 184, 0.4);
}

